<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shattered-Star-POC</title>
  <style>
    body {
      margin: 0;
      background-color: black;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }

    #title-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      z-index: 5;
    }

    .layer {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 2s ease-in-out;
      filter: contrast(1.1) saturate(1.1);
    }

    .visible {
      opacity: 1;
    }

    /* Sprite-based PRESS START */
    #press-start {
      position: absolute;
      bottom: 60px;
      left: 50%;
      transform: translateX(-50%);
      width: 128px; /* one frame width */
      height: 32px; /* frame height */
      background: url('assets/ui/press_start_sheet.png') no-repeat;
      animation: blink 1s steps(5) infinite;
      z-index: 10;
      cursor: pointer;
    }

    @keyframes blink {
      from { background-position: 0 0; }
      to   { background-position: -640px 0; } /* 128px Ã— 5 frames */
    }

    /* Fade-to-black overlay */
    #fadeout {
      position: absolute;
      width: 100%;
      height: 100%;
      background: black;
      opacity: 0;
      pointer-events: none;
      transition: opacity 2s ease-in-out;
      z-index: 20;
    }

    /* Audio mute button */
    #audio-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 6px 12px;
      font-size: 14px;
      color: cyan;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid cyan;
      cursor: pointer;
      z-index: 15;
    }
  </style>
</head>
<body>
  <div id="title-container">
    <img id="layerA" class="layer visible" />
    <img id="layerB" class="layer" />

    <div id="press-start" onclick="startGame()"></div>
    <button id="audio-toggle" onclick="toggleAudio()">MUTE</button>
    <div id="fadeout"></div>
  </div>

  <audio id="intro-audio" src="assets/audio/intro.ogg" preload="auto"></audio>

  <script>
    /* --- IMAGE SEQUENCE --- */
    const sequence = [
      "assets/title/title3.png",
      "assets/title/title4.png",
      "assets/title/title5.png",
      "assets/title/title4.png"
    ];

    let index = 0;
    let showingA = true;

    const layerA = document.getElementById("layerA");
    const layerB = document.getElementById("layerB");

    layerA.src = sequence[0];

    function crossfade() {
      index = (index + 1) % sequence.length;

      if (showingA) {
        layerB.src = sequence[index];
        layerB.classList.add("visible");
        layerA.classList.remove("visible");
      } else {
        layerA.src = sequence[index];
        layerA.classList.add("visible");
        layerB.classList.remove("visible");
      }

      showingA = !showingA;
    }

    setInterval(crossfade, 4000);

    /* --- COSMIC GLITCH EFFECT --- */
    function glitch() {
      const layer = showingA ? layerA : layerB;
      layer.style.filter = "contrast(1.4) saturate(1.4) hue-rotate(35deg)";
      setTimeout(() => {
        layer.style.filter = "contrast(1.1) saturate(1.1)";
      }, 120);
    }

    setInterval(() => {
      if (Math.random() < 0.12) glitch();
    }, 500);

    /* --- AUDIO INTRO + MUTE TOGGLE --- */
    const introAudio = document.getElementById("intro-audio");
    const audioToggle = document.getElementById("audio-toggle");
    let audioMuted = false;
    let audioStarted = false;

    function ensureAudioStart() {
      if (!audioStarted) {
        introAudio.volume = 0.8;
        introAudio.loop = true;
        introAudio.play().catch(() => {});
        audioStarted = true;
      }
    }

    document.addEventListener("click", ensureAudioStart, { once: true });
    document.addEventListener("keydown", ensureAudioStart, { once: true });

    function toggleAudio() {
      audioMuted = !audioMuted;
      introAudio.muted = audioMuted;
      audioToggle.textContent = audioMuted ? "UNMUTE" : "MUTE";
    }

    /* --- PRESS ENTER TO START --- */
    document.addEventListener("keydown", (e) => {
      if (e.key === "Enter") startGame();
    });

    /* --- FADE TO BLACK + REDIRECT --- */
    let starting = false;
    function startGame() {
      if (starting) return;
      starting = true;

      const fade = document.getElementById("fadeout");
      fade.style.opacity = 1;

      setTimeout(() => {
        window.location.href = "https://johms0976-cmyk.github.io/Shattered-Star-POC/game";
      }, 2000);
    }
  </script>
</body>
</html>
