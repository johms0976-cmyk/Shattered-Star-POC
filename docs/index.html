<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shattered-Star-POC</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      overflow: hidden;
      font-family: monospace;
    }

    .screen {
      position: absolute;
      width: 100vw;
      height: 100vh;
      top: 0;
      left: 0;
      display: none;
    }

    .active {
      display: block;
    }

    .title-frame {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .press-enter {
      position: absolute;
      bottom: 5%;
      width: 100%;
      text-align: center;
      font-size: 2em;
      color: #00ccff;
      cursor: pointer;
      animation: blink 1s step-end infinite;
    }

    @keyframes blink {
      50% { opacity: 0; }
    }

    .menu {
      position: absolute;
      top: 60%;
      left: 10%;
      font-size: 2em;
      color: #00ccff;
    }

    .menu-item {
      margin: 15px 0;
      cursor: pointer;
    }

    .menu-item:hover {
      color: white;
    }

    /* GLITCH OVERLAY */
    #glitch {
      position: absolute;
      width: 100vw;
      height: 100vh;
      background: white;
      opacity: 0;
      pointer-events: none;
      mix-blend-mode: screen;
      z-index: 999;
    }

    @keyframes glitchFlash {
      0%   { opacity: 0; transform: translate(0,0); filter: none; }
      15%  { opacity: 1; transform: translate(-5px, 3px); filter: hue-rotate(30deg); }
      30%  { opacity: 0.6; transform: translate(4px, -2px); filter: contrast(2); }
      50%  { opacity: 1; transform: translate(-3px, 1px); }
      70%  { opacity: 0.4; transform: translate(2px, -3px); }
      100% { opacity: 0; transform: translate(0,0); }
    }

    /* MAP */
    #map-screen {
      background: black;
    }

    #map-canvas {
      width: 100%;
      height: 100%;
    }

    .node {
      position: absolute;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      color: black;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 10;
    }

    .node.combat { background: #b33; }
    .node.event { background: #338; color: white; }
    .node.elite { background: gold; }
  </style>
</head>

<body>

<!-- TITLE SCREEN -->
<div id="title-screen" class="screen active">
  <img id="title-image" class="title-frame" src="assets/screens/title/title1.png">
  <div id="press-enter" class="press-enter">PRESS ENTER</div>
</div>

<!-- START SCREEN -->
<div id="start-screen" class="screen">
  <img class="title-frame" src="assets/screens/start/startscreen1.png">
  <div class="menu">
    <div id="new-game" class="menu-item">NEW GAME</div>
    <div class="menu-item">SETTINGS</div>
  </div>
</div>

<!-- NEW GAME SCREEN -->
<div id="newgame-screen" class="screen">
  <img id="newgame-image" class="title-frame" src="assets/screens/new-game/newgame1.png">
</div>

<!-- MAP SCREEN -->
<div id="map-screen" class="screen">
  <canvas id="map-canvas"></canvas>
</div>

<!-- GLITCH -->
<div id="glitch"></div>

<!-- AUDIO -->
<audio id="intro-audio" src="assets/audio/intro.ogg" preload="auto" loop></audio>

<script>
/* ------------------------------
   TITLE ANIMATION
------------------------------ */

const frames = [
  "assets/screens/title/title2.png",
  "assets/screens/title/title3.png",
  "assets/screens/title/title4.png",
  "assets/screens/title/title5.png",
  "assets/screens/title/title4.png",
  "assets/screens/title/title3.png"
];

let frameIndex = 0;
const titleImage = document.getElementById("title-image");

function animateTitle() {
  frameIndex = (frameIndex + 1) % frames.length;
  titleImage.src = frames[frameIndex];
  setTimeout(animateTitle, 150);
}
setTimeout(animateTitle, 150);

/* ------------------------------
   AUDIO
------------------------------ */

const introAudio = document.getElementById("intro-audio");
introAudio.volume = 0.7;

function enableAudio() {
  introAudio.play().catch(() => {});
}
window.addEventListener("click", enableAudio, { once: true });
window.addEventListener("keydown", enableAudio, { once: true });

/* ------------------------------
   GLITCH TRANSITION
------------------------------ */

function glitchTransition(fromId, toId) {
  const glitch = document.getElementById("glitch");
  glitch.style.animation = "none";
  glitch.offsetHeight;
  glitch.style.animation = "glitchFlash 0.35s linear";

  setTimeout(() => {
    document.getElementById(fromId).classList.remove("active");
    document.getElementById(toId).classList.add("active");
  }, 350);
}

/* ------------------------------
   SCREEN FLOW
------------------------------ */

function goToStart() {
  glitchTransition("title-screen", "start-screen");
}

document.getElementById("press-enter").onclick = goToStart;
window.addEventListener("keydown", e => {
  if (e.key === "Enter") goToStart();
});

document.getElementById("new-game").onclick = () => {
  glitchTransition("start-screen", "newgame-screen");

  setTimeout(() => {
    document.getElementById("newgame-image").style.filter =
      "contrast(1.5) hue-rotate(20deg)";
  }, 900);

  setTimeout(() => {
    glitchTransition("newgame-screen", "map-screen");
    setTimeout(initMap, 400);
  }, 1200);
};

/* ------------------------------
   MAP (PLACEHOLDER, BRANCHING)
------------------------------ */

function initMap() {
  const canvas = document.getElementById("map-canvas");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  ctx.strokeStyle = "#555";
  ctx.lineWidth = 2;

  const nodes = [
    { x: 200, y: 300, type: "combat" },
    { x: 450, y: 200, type: "event" },
    { x: 450, y: 400, type: "combat" },
    { x: 700, y: 300, type: "elite" }
  ];

  drawLine(ctx, nodes[0], nodes[1]);
  drawLine(ctx, nodes[0], nodes[2]);
  drawLine(ctx, nodes[1], nodes[3]);
  drawLine(ctx, nodes[2], nodes[3]);

  nodes.forEach(n => createNode(n));
}

function drawLine(ctx, a, b) {
  ctx.beginPath();
  ctx.moveTo(a.x + 20, a.y + 20);
  ctx.lineTo(b.x + 20, b.y + 20);
  ctx.stroke();
}

function createNode(node) {
  const el = document.createElement("div");
  el.className = `node ${node.type}`;
  el.style.left = node.x + "px";
  el.style.top = node.y + "px";
  el.innerText = node.type[0].toUpperCase();
  el.onclick = () => alert(node.type.toUpperCase());
  document.getElementById("map-screen").appendChild(el);
}
</script>

</body>
</html>
